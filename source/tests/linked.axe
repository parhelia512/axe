use stdlib/arena (
    Arena,
    arena_create,
    arena_destroy,
    arena_alloc
);

use stdlib/memory (
    size_of
);

model Node {
    value: int;
    next: ref Node;
}

def new_node(arena: Arena, value: int): ref Node {
    val ptr: long = arena_alloc(ref_of(arena), size_of(Node));
    mut val n: ref Node = deref(ptr);
    n.value = value;
    n.next = nil;
    return n;
}

def list_push_front(head: ref Node, arena: Arena, value: int): ref Node {
    mut val new_head: ref Node = new_node(arena, value);
    new_head.next = head;
    return new_head;
}

def list_push_back(head: ref Node, arena: Arena, value: int): ref Node {
    if head == nil {
        return new_node(arena, value);
    }

    mut val cur: ref Node = head;
    loop {
        if cur.next == nil {
            break;
        }
        cur = cur.next;
    }

    cur.next = new_node(arena, value);
    return head;
}

/// Print linked list
def list_print(head: Node) {
    mut val cur: ref Node = head;

    loop {
        if cur.next == nil {
            break;
        }

        print cur.value;
        print " ";
        cur = deref(cur.next);
    }

    println "";
}

main {
    mut val arena: Arena = arena_create(65536);
    mut val head: ref Node = nil;

    head = list_push_front(head, arena, 10);
    head = list_push_front(head, arena, 5);
    head = list_push_back(head, arena, 20);
    head = list_push_back(head, arena, 25);

    println "List contents:";
    list_print(head);

    arena_destroy(ref_of(arena));
    println "Arena destroyed.";
}
