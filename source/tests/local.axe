use std.arena;
use std.io;
use std.parallelism;

def worker(arena: ref Arena, value: i32): i32 {
    mut p: ref i32 = cast[ref i32](Arena.alloc(arena, sizeof(i32)));
    deref(p) = value * value;
    return deref(p);
}

def main() {
    println "Running parallel computation...";

    parallel local(mut arena: Arena) {
        arena = Arena.create(1024);
        val tid: i32 = Parallel.thread_id();
        val result: i32 = worker(addr(arena), tid);
        println $"Thread {tid} computed {result}";
        Arena.destroy(addr(arena));
    }

    println "Done.";
}
